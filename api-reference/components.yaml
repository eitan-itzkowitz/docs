components:
  schemas:
    MonetaryValue:
      type: object
      title: MonetaryValue
      description: "A standardized format for monetary values, including amount and currency."
      properties:
        amount:
          type: number
          format: double
          description: "The monetary amount, formatted as a numeric value with up to two decimal places. Negative values represent credits or refunds."
          examples: [1234.56, -500]
        currency:
          type: string
          pattern: "^[A-Z]{3}$"
          description: "The currency in which the amount is denominated, following the ISO 4217 standard (e.g., USD, EUR, GBP)."
          examples: ["USD", "EUR"]
      required: ["amount", "currency"]

    TaxRate:
      type: object
      title: TaxRate
      description: "Represents tax configurations for a company, including jurisdiction, calculation method, and parameters."
      properties:
        id:
          type: string
          description: "A unique identifier for the tax rate."
        createdAt:
          type: string
          format: date-time
          description: "Timestamp when the tax rate was created."
        updatedAt:
          type: string
          format: date-time
          description: "Timestamp when the tax rate was last updated."
        removedAt:
          type: string
          format: date-time
          description: "Timestamp when the tax rate was removed. Null if active."
        company:
          type: object
          description: "Reference to the company associated with this tax rate."
          properties:
            id: { type: string }
            legalName: { type: string }
        displayName:
          type: string
          description: "The display name of the tax rate, such as 'California Sales Tax'."
        taxType:
          type: string
          description: "Defines the nature of the tax."
          enum:
            - payroll_employer
            - payroll_withholding
            - sales_tax
            - value_added_tax
            - income_tax
            - franchise_tax
            - excise_tax
            - real_property_tax
            - customs_duty
        jurisdictionType:
          type: string
          description: "The jurisdiction where this tax applies."
          enum:
            - Federal
            - State
            - City
            - County
            - Province
            - Other
        jurisdictionName:
          type: string
          description: "The specific name of the jurisdiction where the tax applies."
        calculationType:
          type: string
          description: "Specifies how the tax is calculated."
          enum:
            - percentage_flat
            - percentage_progressive
            - flat_per_tier
            - flat_per_unit
            - flat
        calculation_parameters:
          type: object
          description: "Calculation-specific parameters for this tax rate."
          properties:
            percentageRate:
              type: number
              description: "The flat percentage rate for taxes like sales_tax."
              example: 7.25
            tiers:
              type: array
              description: "Details for progressive or tiered taxes."
              items:
                type: object
                properties:
                  upperLimit:
                    type: number
                    description: "The maximum value for this tier."
                    example: 10000
                  rate:
                    type: number
                    description: "The percentage or flat rate for this tier."
                    example: 10
            unitRate:
              type: number
              description: "The rate applied per unit for unit-based taxes like payroll_employer."
              example: 7.5
            unit:
              type: string
              description: "The unit of measure for unit-based taxes."
              example: employee
            cap:
              type: number
              description: "The maximum taxable amount for capped percentage calculations."
              example: 14200
        effectiveDate:
          type: string
          format: date-time
          description: "The start date for the tax rate."
        expirationDate:
          type: string
          format: date-time
          description: "The end date for the tax rate, if applicable."
      required:
        - id
        - createdAt
        - company
        - displayName
        - jurisdictionType
        - jurisdictionName
        - calculationType

    Bill:
      type: object
      title: Bill
      description: |
        The Bill object represents a single record of expenses incurred by the company.
        Each bill is linked to exactly one vendor, contains one or more bill line items, and has a due date.
        The total amount of the bill is derived from the sum of its associated line items, plus shipping charges, 
        adjusted by bill-level taxes and discounts. Attachments and payment details provide additional tracking and context.
      properties:
        id:
          type: string
          description: A unique identifier for the bill. This is auto-generated and immutable.
        company:
          type: object
          description: References the company associated with the bill.
          properties:
            id: { type: string }
            legalName: { type: string }
        createdAt:
          type: string
          format: date-time
          description: The timestamp when the bill was created.
        updatedAt:
          type: string
          format: date-time
          description: The timestamp when the bill was last updated.
        vendor:
          type: object
          description: References the vendor associated with the bill.
          properties:
            id: { type: string }
            name: { type: string }
        issueDate:
          type: string
          format: date
          description: The date the bill was issued.
        dueDate:
          type: string
          format: date
          description: The date the bill is due for payment.
        externalId:
          type: string
          description: |
            An external reference ID for the bill, often used for integration with third-party systems 
            or ERP platforms for tracking and reconciliation purposes.
        description:
          type: string
          description: A brief description or memo about the bill.
        billLines:
          type: array
          description: A list of one or more line items associated with the bill.
          items:
            type: object
            properties:
              id: { type: string }
              description: { type: string }
              amount: { $ref: "#/components/schemas/MonetaryValue" }
        billLevelTaxes:
          type: array
          description: Taxes applied at the bill level.
          items:
            type: object
            properties:
              id: { type: string }
              taxedAmount: { $ref: "#/components/schemas/MonetaryValue" }
              taxAmount: { $ref: "#/components/schemas/MonetaryValue" }
              taxRate: { $ref: "#/components/schemas/TaxRate" }
        billLevelDiscounts:
          type: array
          description: Discounts applied at the bill level.
          items:
            type: object
            properties:
              id: { type: string }
              amount: { $ref: "#/components/schemas/MonetaryValue" }
        shippingLines:
          type: array
          description: Shipping and handling charges associated with the bill.
          items:
            type: object
            properties:
              id: { type: string }
              subtotal: { $ref: "#/components/schemas/MonetaryValue" }
              taxAmount: { $ref: "#/components/schemas/MonetaryValue" }
              total: { $ref: "#/components/schemas/MonetaryValue" }
        payments:
          type: array
          description: A list of payments applied to this bill.
          items:
            type: object
            properties:
              id: { type: string }
              date: { type: string, format: date }
              amount: { $ref: "#/components/schemas/MonetaryValue" }
              method: { type: string, description: "Payment method used." }
        status:
          type: string
          enum:
            - Deleted
            - Draft
            - Posted
            - Voided
            - Paid
          description: Represents the current status of the bill.
        dueStatus:
          type: string
          enum:
            - Current
            - Overdue
          description: Indicates whether the bill is currently due or overdue.
        paidAt:
          type: string
          format: date-time
          description: The timestamp when the bill was fully paid.
        files:
          type: array
          description: A list of files attached to the bill, such as receipts, invoices, or supplementary documents.
          items:
            type: object
            properties:
              id: { type: string }
              filename: { type: string }
              contentType: { type: string }
              size: { type: integer }
              isDeleted: { type: boolean }
              downloadInfo: { type: string }
      required:
        - id
        - company
        - createdAt
        - vendor
        - issueDate
        - dueDate
        - billLines
        - status
        - dueStatus
